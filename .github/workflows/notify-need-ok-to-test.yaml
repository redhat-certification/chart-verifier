name: Notify ok-to-test required

on:
  pull_request_target: # zizmor: ignore[dangerous-triggers] # pull_request_target is needed to be able to comment on the pull request.
    branches: [main]
    types:
      - opened
      - reopened

jobs:
  notify-on-open:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
    - run: |
        gh pr comment --repo "${REPOSITORY}" "${PR_NUMBER}" --body "${COMMENT_BODY}"
      env:
        PR_NUMBER: ${{ github.event.pull_request.number }} 
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        REPOSITORY: ${{ github.repository }}
        COMMENT_BODY: |
          Thanks for your pull request!
          
          A maintainer will review this pull request and trigger functional testing by adding the *ok-to-test* label.

          _This comment was auto-generated by [GitHub Actions](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})._
